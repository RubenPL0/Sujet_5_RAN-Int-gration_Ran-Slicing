Active_gNBs = ( "gNB-NexSlice-RFsim");

gNBs =
(
 {
    ////////// Identification parameters:
    gNB_ID = 0xe00;
    gNB_name  =  "gNB-NexSlice-RFsim";

    // Tracking area code
    tracking_area_code  =  1;
    plmn_list = ({
                  mcc = 001;
                  mnc = 01;
                  mnc_length = 2;
                  snssaiList = (
                    {
                      sst = 1;
                      sd  = 0x000001; # eMBB slice
                    },
                    {
                      sst = 1;
                      sd  = 0x000002; # URLLC slice
                    },
                    {
                      sst = 1;
                      sd  = 0x000003; # mMTC slice
                    }
                  );
                  });

    nr_cellid = 12345678L;

    ////////// Physical parameters:
    servingCellConfigCommon = (
    {
      physCellId                                                    = 0;

      # Downlink config - 3.5 GHz band n78
      absoluteFrequencySSB                                             = 641280;
      dl_frequencyBand                                                 = 78;
      dl_absoluteFrequencyPointA                                       = 640008;
      dl_offstToCarrier                                              = 0;
      dl_subcarrierSpacing                                           = 1;  # 30kHz
      dl_carrierBandwidth                                            = 106; # PRBs

      initialDLBWPlocationAndBandwidth                               = 28875;
      initialDLBWPsubcarrierSpacing                                  = 1;
      initialDLBWPcontrolResourceSetZero                             = 12;
      initialDLBWPsearchSpaceZero                                    = 0;

      # Uplink config
      ul_frequencyBand                                                 = 78;
      ul_offstToCarrier                                              = 0;
      ul_subcarrierSpacing                                           = 1;  # 30kHz
      ul_carrierBandwidth                                            = 106; # PRBs
      pMax                                                          = 20;

      initialULBWPlocationAndBandwidth                            = 28875;
      initialULBWPsubcarrierSpacing                               = 1;

      # RACH config
      prach_ConfigurationIndex                                  = 98;
      prach_msg1_FDM                                            = 0;
      prach_msg1_FrequencyStart                                 = 0;
      zeroCorrelationZoneConfig                                 = 13;
      preambleReceivedTargetPower                               = -96;
      preambleTransMax                                          = 6;
      powerRampingStep                                            = 1;
      ra_ResponseWindow                                           = 4;
      ssb_perRACH_OccasionAndCB_PreamblesPerSSB_PR                = 4;
      ssb_perRACH_OccasionAndCB_PreamblesPerSSB                   = 14;
      ra_ContentionResolutionTimer                                = 7;
      rsrp_ThresholdSSB                                           = 19;
      prach_RootSequenceIndex_PR                                  = 2;
      prach_RootSequenceIndex                                     = 1;
      msg1_SubcarrierSpacing                                      = 1;
      restrictedSetConfig                                         = 0;
      msg3_DeltaPreamble                                          = 1;
      p0_NominalWithGrant                                         = -90;

      # PUCCH config
      pucchGroupHopping                                           = 0;
      hoppingId                                                   = 40;
      p0_nominal                                                  = -90;

      # SSB config
      ssb_PositionsInBurst_PR                                       = 2;
      ssb_PositionsInBurst_Bitmap                                   = 1;
      ssb_periodicityServingCell                                    = 2;
      dmrs_TypeA_Position                                           = 0;
      subcarrierSpacing                                             = 1;

      # TDD config
      referenceSubcarrierSpacing                                    = 1;
      dl_UL_TransmissionPeriodicity                                 = 6;
      nrofDownlinkSlots                                             = 7;
      nrofDownlinkSymbols                                           = 6;
      nrofUplinkSlots                                               = 2;
      nrofUplinkSymbols                                             = 4;

      ssPBCH_BlockPower                                             = -25;
    });

    # SCTP parameters
    SCTP :
    {
        SCTP_INSTREAMS  = 2;
        SCTP_OUTSTREAMS = 2;
    };

    # AMF connection
    amf_ip_address      = ( { ipv4       = "192.168.70.132";
                              ipv6       = "192:168:30::17";
                              active     = "yes";
                              preference = "ipv4";
                            }
                          );

    NETWORK_INTERFACES :
    {
        GNB_INTERFACE_NAME_FOR_NG_AMF            = "eth0";
        GNB_IPV4_ADDRESS_FOR_NG_AMF              = "192.168.70.129";
        GNB_INTERFACE_NAME_FOR_NGU               = "eth0";
        GNB_IPV4_ADDRESS_FOR_NGU                 = "192.168.70.129";
        GNB_PORT_FOR_S1U                         = 2152;
    };
  }
);

# MAC/RLC configuration
MACRLCs = (
  {
    num_cc                      = 1;
    tr_s_preference             = "local_L1";
    tr_n_preference             = "f1";
    pusch_TargetSNRx10          = 150;
    pucch_TargetSNRx10          = 200;
    ulsch_max_frame_inactivity  = 10;
  }
);

# L1 configuration
L1s = (
{
  num_cc = 1;
  tr_n_preference = "local_mac";
  prach_dtx_threshold = 120;
  pucch0_dtx_threshold = 150;
  ofdm_offset_divisor = 8;
}
);

# RFsimulator configuration
RUs = (
  {
    local_rf       = "yes"
    nb_tx          = 1
    nb_rx          = 1
    att_tx         = 0
    att_rx         = 0;
    bands          = [78];
    max_pdschReferenceSignalPower = -27;
    max_rxgain                    = 114;
    eNB_instances  = [0];
    bf_weights = [0x00007fff, 0x0000];
    clock_src = "internal";
  }
);

THREAD_STRUCT = (
  {
    parallel_config    = "PARALLEL_SINGLE_THREAD";
    worker_config      = "WORKER_ENABLE";
  }
);

rfsimulator :
{
    serveraddr = "server";
    serverport = "4043";
    options = ();
    modelname = "AWGN";
    IQfile = "/tmp/rfsimulator.iqs"
};

log_config :
{
  global_log_level                      ="info";
  hw_log_level                          ="info";
  phy_log_level                         ="info";
  mac_log_level                         ="info";
  rlc_log_level                         ="info";
  pdcp_log_level                        ="info";
  rrc_log_level                         ="info";
  ngap_log_level                        ="debug";
  f1ap_log_level                        ="info";
};
